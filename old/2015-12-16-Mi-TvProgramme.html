<html>
<head>
	<title>Dennis Salzner - 2015-12-16-Mi-TvProgramme</title>
<!--- Python-Code ############################################################################################################################## --->
<meta http-equiv="content-type" content="text/html; charset=latin1">
<style type="text/css">
td.linenos { background-color: #f0f0f0; padding-right: 10px; }
span.lineno { background-color: #f0f0f0; padding: 0 5px 0 5px; }
pre { line-height: 125%; }
body .hll { background-color: #ffffcc }
body  { background: #f8f8f8; }
body .c { color: #408080; font-style: italic } /* Comment */
body .err { border: 1px solid #FF0000 } /* Error */
body .k { color: #008000; font-weight: bold } /* Keyword */
body .o { color: #666666 } /* Operator */
body .cm { color: #408080; font-style: italic } /* Comment.Multiline */
body .cp { color: #BC7A00 } /* Comment.Preproc */
body .c1 { color: #408080; font-style: italic } /* Comment.Single */
body .cs { color: #408080; font-style: italic } /* Comment.Special */
body .gd { color: #A00000 } /* Generic.Deleted */
body .ge { font-style: italic } /* Generic.Emph */
body .gr { color: #FF0000 } /* Generic.Error */
body .gh { color: #000080; font-weight: bold } /* Generic.Heading */
body .gi { color: #00A000 } /* Generic.Inserted */
body .go { color: #888888 } /* Generic.Output */
body .gp { color: #000080; font-weight: bold } /* Generic.Prompt */
body .gs { font-weight: bold } /* Generic.Strong */
body .gu { color: #800080; font-weight: bold } /* Generic.Subheading */
body .gt { color: #0044DD } /* Generic.Traceback */
body .kc { color: #008000; font-weight: bold } /* Keyword.Constant */
body .kd { color: #008000; font-weight: bold } /* Keyword.Declaration */
body .kn { color: #008000; font-weight: bold } /* Keyword.Namespace */
body .kp { color: #008000 } /* Keyword.Pseudo */
body .kr { color: #008000; font-weight: bold } /* Keyword.Reserved */
body .kt { color: #B00040 } /* Keyword.Type */
body .m { color: #666666 } /* Literal.Number */
body .s { color: #BA2121 } /* Literal.String */
body .na { color: #7D9029 } /* Name.Attribute */
body .nb { color: #008000 } /* Name.Builtin */
body .nc { color: #0000FF; font-weight: bold } /* Name.Class */
body .no { color: #880000 } /* Name.Constant */
body .nd { color: #AA22FF } /* Name.Decorator */
body .ni { color: #999999; font-weight: bold } /* Name.Entity */
body .ne { color: #D2413A; font-weight: bold } /* Name.Exception */
body .nf { color: #0000FF } /* Name.Function */
body .nl { color: #A0A000 } /* Name.Label */
body .nn { color: #0000FF; font-weight: bold } /* Name.Namespace */
body .nt { color: #008000; font-weight: bold } /* Name.Tag */
body .nv { color: #19177C } /* Name.Variable */
body .ow { color: #AA22FF; font-weight: bold } /* Operator.Word */
body .w { color: #bbbbbb } /* Text.Whitespace */
body .mf { color: #666666 } /* Literal.Number.Float */
body .mh { color: #666666 } /* Literal.Number.Hex */
body .mi { color: #666666 } /* Literal.Number.Integer */
body .mo { color: #666666 } /* Literal.Number.Oct */
body .sb { color: #BA2121 } /* Literal.String.Backtick */
body .sc { color: #BA2121 } /* Literal.String.Char */
body .sd { color: #BA2121; font-style: italic } /* Literal.String.Doc */
body .s2 { color: #BA2121 } /* Literal.String.Double */
body .se { color: #BB6622; font-weight: bold } /* Literal.String.Escape */
body .sh { color: #BA2121 } /* Literal.String.Heredoc */
body .si { color: #BB6688; font-weight: bold } /* Literal.String.Interpol */
body .sx { color: #008000 } /* Literal.String.Other */
body .sr { color: #BB6688 } /* Literal.String.Regex */
body .s1 { color: #BA2121 } /* Literal.String.Single */
body .ss { color: #19177C } /* Literal.String.Symbol */
body .bp { color: #008000 } /* Name.Builtin.Pseudo */
body .vc { color: #19177C } /* Name.Variable.Class */
body .vg { color: #19177C } /* Name.Variable.Global */
body .vi { color: #19177C } /* Name.Variable.Instance */
body .il { color: #666666 } /* Literal.Number.Integer.Long */
</style>
<!--- ############################################################################################################################## --->
  
<meta property="og:image" content="grafiken/2015-12-16-Mi-TvProgramme/001t.png"/>
<meta property="og:description" content="2015-12-16-Mi-TvProgramme - This script parses an online TV programme website. It filters out the bad channels, reorders the good ones and generates a cleaned list. This cleaned list is accessable on a webserver, which it spawns itself. The webserver can be accessed from your smartphone on the local area network."/>
 
  <!-- stats -->
<script type="text/javascript">
  var _paq = window._paq = window._paq || [];
  /* tracker methods like "setCustomDimension" should be called before "trackPageView" */
  _paq.push(['trackPageView']);
  _paq.push(['enableLinkTracking']);
  (function() {
    var u="//dennissalzner.de/stats/matomo/";
    _paq.push(['setTrackerUrl', u+'matomo.php']);
    _paq.push(['setSiteId', '1']);
    var d=document, g=d.createElement('script'), s=d.getElementsByTagName('script')[0];
    g.type='text/javascript'; g.async=true; g.src=u+'matomo.js'; s.parentNode.insertBefore(g,s);
  })();
</script>
  <!-- stats -->
</head>

<body>

<h1>Dennis Salzner - 2015-12-16-Mi-TvProgramme</h1>
<link rel="image_src" href="grafiken/2015-12-16-Mi-TvProgramme/001t.png" />

<p align="right" style="font-size:80%">
	<a href="../"><< Back Home</a> 
</p>
			
<table style="width:100%">
	<tr>
		<td style="vertical-align: top;">
			<a href="#null" onclick="newWindow('grafiken/2015-12-16-Mi-TvProgramme/001.png','','640','480','')">
				<img src="grafiken/2015-12-16-Mi-TvProgramme/001t.png" width="160" height="166">
			</a>
			<a href="#null" onclick="newWindow('grafiken/2015-12-16-Mi-TvProgramme/002.png','','640','480','')">
				<img src="grafiken/2015-12-16-Mi-TvProgramme/002t.png" width="160" height="230">
			</a>
		</td>
		<td style="vertical-align: top;">
			<!-- Titel -->
			<h2>
Programming: Web scraping for a custom TV-Programme
			</h2>
			<!-- Was -->
			<p align="right" style="font-size:60%">What?</p>
			<p style="font-size:80%">
This script parses an online TV programme website. It filters out the bad channels, reorders the good ones and generates a cleaned list. This cleaned list is accessable on a webserver, which it spawns itself. The webserver can be accessed from your smartphone on the local area network.

This was neccessary, because the online TV programme website has has a terrible layout, is loaded with flash advertisements, JavaScript tracking codes and popups advertisements. What ever happend to the days when Internet connections were slow and they didn't make you load all of that crap.

			</p>
			<!-- Wann -->
			<p align="right" style="font-size:60%">When?</p>
			<p style="font-size:80%">

			</p>
			<!-- Warum -->
			<p align="right" style="font-size:60%">Why?</p>
			<p style="font-size:80%">

			</p>
			<!-- Hintergrund -->
			<p align="right" style="font-size:60%">Background?</p>
			<p style="font-size:80%">

			</p>
			<!-- Wie -->
			<p align="right" style="font-size:60%">How?</p>
			<p style="font-size:80%">



<!--- Python-Code ############################################################################################################################## --->
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76</pre></div></td><td class="code"><div class="highlight"><pre><span class="c"># dsalzner 2015-12-16-Sa</span>

<span class="kn">from</span> <span class="nn">BeautifulSoup</span> <span class="kn">import</span> <span class="n">BeautifulSoup</span> <span class="k">as</span> <span class="n">Soup</span>
<span class="kn">import</span> <span class="nn">urllib</span>
<span class="kn">import</span> <span class="nn">HTMLParser</span>
<span class="n">h</span> <span class="o">=</span> <span class="n">HTMLParser</span><span class="o">.</span><span class="n">HTMLParser</span><span class="p">()</span>

<span class="kn">from</span> <span class="nn">flask</span> <span class="kn">import</span> <span class="n">Flask</span><span class="p">,</span> <span class="n">Response</span>
<span class="n">app</span> <span class="o">=</span> <span class="n">Flask</span><span class="p">(</span><span class="n">__name__</span><span class="p">)</span>

<span class="n">senderFilter</span> <span class="o">=</span> <span class="p">[</span>
	<span class="s">&quot;ARD ALPHA&quot;</span><span class="p">,</span>    <span class="s">&quot;ARTE&quot;</span><span class="p">,</span>       <span class="s">&quot;ZDF info&quot;</span><span class="p">,</span>   <span class="s">&quot;ZDF neo&quot;</span><span class="p">,</span>      <span class="s">&quot;Eins Plus&quot;</span><span class="p">,</span>  <span class="s">&quot;3sat&quot;</span><span class="p">,</span> 
	<span class="s">&quot;N24&quot;</span><span class="p">,</span>          <span class="s">&quot;NTV&quot;</span><span class="p">,</span>        <span class="s">&quot;ARD&quot;</span><span class="p">,</span>        <span class="s">&quot;ZDF&quot;</span><span class="p">,</span>          <span class="s">&quot;VIVA&quot;</span><span class="p">,</span>       <span class="s">&quot;Comedy Central&quot;</span><span class="p">,</span> 
	<span class="s">&quot;EinsFestival&quot;</span><span class="p">,</span> <span class="s">&quot;ZDFkultur&quot;</span><span class="p">,</span>  <span class="s">&quot;Phoenix&quot;</span><span class="p">,</span>    <span class="s">&quot;Tagesschau24&quot;</span><span class="p">,</span>	<span class="s">&quot;NICK&quot;</span><span class="p">,</span>       <span class="s">&quot;DMAX&quot;</span><span class="p">,</span>
	<span class="s">&quot;sixx&quot;</span><span class="p">,</span>         <span class="s">&quot;RTL NITRO&quot;</span><span class="p">,</span>  <span class="s">&quot;TELE 5&quot;</span><span class="p">,</span>     <span class="s">&quot;RTL&quot;</span><span class="p">,</span>          <span class="s">&quot;SAT.1&quot;</span><span class="p">,</span>      <span class="s">&quot;Pro7&quot;</span><span class="p">,</span> 
	<span class="s">&quot;RTL 2&quot;</span><span class="p">,</span>        <span class="s">&quot;VOX&quot;</span><span class="p">,</span>        <span class="s">&quot;Kabel eins&quot;</span><span class="p">,</span>	<span class="s">&quot;Super RTL&quot;</span><span class="p">,</span>    <span class="s">&quot;Servus TV&quot;</span><span class="p">,</span>  <span class="s">&quot;Kabel eins Classics&quot;</span>
<span class="p">]</span>

<span class="n">programmAuswahl</span> <span class="o">=</span> <span class="p">[</span>
	<span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="s">&quot;Jetzt&quot;</span><span class="p">),</span>
	<span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="s">&quot;20:15&quot;</span><span class="p">),</span>
	<span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="s">&quot;22:00&quot;</span><span class="p">),</span>
<span class="p">]</span>

<span class="k">def</span> <span class="nf">parse</span><span class="p">(</span><span class="n">link</span><span class="p">):</span>
	<span class="n">soup</span> <span class="o">=</span> <span class="n">Soup</span><span class="p">(</span><span class="n">urllib</span><span class="o">.</span><span class="n">urlopen</span><span class="p">(</span><span class="n">link</span><span class="p">))</span>
	<span class="n">data</span> <span class="o">=</span> <span class="p">[]</span>
	<span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="n">broadcast</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">soup</span><span class="o">.</span><span class="n">findAll</span><span class="p">(</span><span class="s">&quot;table&quot;</span><span class="p">,</span> <span class="p">{</span> <span class="s">&quot;class&quot;</span> <span class="p">:</span> <span class="s">&quot;broadcasts&quot;</span> <span class="p">})):</span>

		<span class="k">for</span> <span class="n">tr</span> <span class="ow">in</span> <span class="n">broadcast</span><span class="o">.</span><span class="n">findAll</span><span class="p">(</span><span class="s">&quot;tr&quot;</span><span class="p">):</span>
			<span class="n">sender</span> <span class="o">=</span> <span class="s">&quot;&quot;</span>
			<span class="n">zeit</span> <span class="o">=</span> <span class="s">&quot;&quot;</span>
			<span class="n">titel</span> <span class="o">=</span> <span class="s">&quot;&quot;</span>
			
			<span class="k">for</span> <span class="n">station</span> <span class="ow">in</span> <span class="n">tr</span><span class="o">.</span><span class="n">findAll</span><span class="p">(</span><span class="s">&quot;td&quot;</span><span class="p">,</span> <span class="p">{</span> <span class="s">&quot;class&quot;</span> <span class="p">:</span> <span class="s">&quot;smallStation&quot;</span> <span class="p">}):</span>
				<span class="n">sender</span> <span class="o">=</span> <span class="n">h</span><span class="o">.</span><span class="n">unescape</span><span class="p">(</span><span class="n">station</span><span class="o">.</span><span class="n">contents</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">())</span>
					
			<span class="k">for</span> <span class="n">time</span> <span class="ow">in</span> <span class="n">tr</span><span class="o">.</span><span class="n">findAll</span><span class="p">(</span><span class="s">&quot;td&quot;</span><span class="p">,</span> <span class="p">{</span> <span class="s">&quot;class&quot;</span> <span class="p">:</span> <span class="s">&quot;smallTime&quot;</span> <span class="p">}):</span>
				<span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">time</span><span class="o">.</span><span class="n">findAll</span><span class="p">(</span><span class="s">&quot;a&quot;</span><span class="p">):</span>
					<span class="n">zeit</span> <span class="o">=</span> <span class="n">h</span><span class="o">.</span><span class="n">unescape</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">contents</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">())</span>
				
			<span class="k">for</span> <span class="n">title</span> <span class="ow">in</span> <span class="n">tr</span><span class="o">.</span><span class="n">findAll</span><span class="p">(</span><span class="s">&quot;td&quot;</span><span class="p">,</span> <span class="p">{</span> <span class="s">&quot;class&quot;</span> <span class="p">:</span> <span class="s">&quot;smallTitle&quot;</span> <span class="p">}):</span>
				<span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">title</span><span class="o">.</span><span class="n">findAll</span><span class="p">(</span><span class="s">&quot;a&quot;</span><span class="p">):</span>
					<span class="n">titel</span> <span class="o">=</span> <span class="n">h</span><span class="o">.</span><span class="n">unescape</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">contents</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">())</span>
				
			<span class="n">data</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">idx</span><span class="p">,</span> <span class="n">zeit</span><span class="p">,</span> <span class="n">sender</span><span class="p">,</span> <span class="n">titel</span><span class="p">))</span>
			
	<span class="k">return</span> <span class="n">data</span>
	
<span class="k">def</span> <span class="nf">programm</span><span class="p">():</span>
	<span class="n">p1</span> <span class="o">=</span> <span class="n">parse</span><span class="p">(</span><span class="s">&quot;http://www.klack.de/?typeID=-3&amp;typeName=all&quot;</span><span class="p">)</span>

	<span class="n">p2</span> <span class="o">=</span> <span class="p">[]</span>
	<span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">senderFilter</span><span class="p">:</span>
		<span class="n">p</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">p1</span> <span class="k">if</span> <span class="n">s</span> <span class="o">==</span> <span class="n">x</span><span class="p">[</span><span class="mi">2</span><span class="p">]]</span>
		<span class="n">p2</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>

	<span class="n">text</span> <span class="o">=</span> <span class="s">&quot;&lt;html&gt;&lt;body&gt;&lt;h1&gt;Fernsehprogramm&lt;/h1&gt;&quot;</span>
	<span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">programmAuswahl</span><span class="p">:</span>
		<span class="p">(</span><span class="nb">id</span><span class="p">,</span> <span class="n">titel</span><span class="p">)</span> <span class="o">=</span> <span class="n">a</span>
		<span class="n">text</span> <span class="o">+=</span> <span class="s">&quot;&lt;h2&gt; &quot;</span> <span class="o">+</span> <span class="n">titel</span> <span class="o">+</span> <span class="s">&quot;&lt;/h2&gt;&lt;table&gt;&quot;</span>
		<span class="n">p3</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">p2</span> <span class="k">if</span> <span class="nb">bool</span><span class="p">(</span><span class="nb">set</span><span class="p">([</span><span class="nb">id</span><span class="p">])</span><span class="o">.</span><span class="n">intersection</span><span class="p">(</span><span class="nb">set</span><span class="p">([</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]])))]</span>	
		<span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">p3</span><span class="p">:</span>
			<span class="p">(</span><span class="n">idx</span><span class="p">,</span> <span class="n">zeit</span><span class="p">,</span> <span class="n">sender</span><span class="p">,</span> <span class="n">titel</span><span class="p">)</span> <span class="o">=</span> <span class="n">p</span>
			<span class="n">text</span> <span class="o">+=</span> <span class="s">&quot;&lt;tr&gt;&lt;td width=&quot;&quot;120px&quot;&quot;&gt;&quot;</span> <span class="o">+</span> <span class="n">zeit</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">20</span><span class="p">]</span> <span class="o">+</span> <span class="s">&quot;&lt;/td&gt;&lt;td width=&quot;&quot;150px&quot;&quot;&gt;&quot;</span> <span class="o">+</span> <span class="n">sender</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">20</span><span class="p">]</span> <span class="o">+</span> <span class="s">&quot;&lt;/td&gt;&lt;td width=&quot;&quot;550px&quot;&quot;&gt;&quot;</span> <span class="o">+</span> <span class="n">titel</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">70</span><span class="p">]</span> <span class="o">+</span> <span class="s">&quot;&lt;/td&gt;&lt;/tr&gt;&quot;</span>
		<span class="n">text</span> <span class="o">+=</span> <span class="s">&quot;&lt;/table&gt;&quot;</span>
	<span class="n">text</span> <span class="o">+=</span> <span class="s">&quot;&lt;/body&gt;&lt;/html&gt;&quot;</span>
	<span class="k">print</span> <span class="n">text</span>
	<span class="k">return</span> <span class="n">text</span>

<span class="nd">@app.route</span><span class="p">(</span><span class="s">&#39;/&#39;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">seite</span><span class="p">():</span>
	<span class="k">return</span> <span class="n">Response</span><span class="p">(</span><span class="n">programm</span><span class="p">(),</span> <span class="n">mimetype</span><span class="o">=</span><span class="s">&quot;text/html&quot;</span><span class="p">)</span>
	
<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">&#39;__main__&#39;</span><span class="p">:</span>
	<span class="n">app</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">port</span><span class="o">=</span><span class="mi">80</span><span class="p">,</span> <span class="n">debug</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
</pre></div>
</td></tr></table>
<!--- ############################################################################################################################## --->
			
			</p>
			<!-- Fortschritt -->
			<p align="right" style="font-size:60%">Progress?</p>
			<p style="font-size:80%">

			</p>
		</td>

	</tr>
</table>

<!-- -------------------------------------------------------------------------------------- -->
<script type="text/javascript" language="JavaScript">
// Centered Pop-Up Window (v1.0)
// (C) 2002-2005 www.smileycat.com
// Free for all users, but leave in this header</code><br>

var win = null;
function newWindow(mypage,myname,w,h,features) {
  var winl = (screen.width-w)/2;
  var wint = (screen.height-h)/2;
  if (winl = 0) winl = 0;
  if (wint = 0) wint = 0;
  var settings = 'height=' + h + ',';
  settings += 'width=' + w + ',';
  settings += 'top=' + wint + ',';
  settings += 'left=' + winl + ',';
  settings += features;
  win = window.open(mypage,myname,settings);
  win.window.focus();
}
</script>

</body>
</html>
